# .github/workflows/simple-bot.yml
# Versión SIMPLIFICADA - Solo crea productos locales
name: 🤖 Simple Product Bot
on:
  schedule:
    - cron: '0 */12 * * *'  # Cada 12 horas
  workflow_dispatch:

jobs:
  create-products:
    name: 📊 Crear Productos
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 🐍 Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: 📦 Install Dependencies  
        run: |
          pip install requests openai==0.28.1 reportlab

      - name: 🔍 Verify API Key
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          if [ -z "$OPENAI_API_KEY" ]; then
            echo "❌ OPENAI_API_KEY no configurado"
            exit 1
          fi
          echo "✅ OpenAI API configurada"

      - name: 🚀 Create Products
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python simple_main.py

      - name: 📁 List Created Files
        run: |
          echo "📊 Archivos creados:"
          ls -la *.pdf *.txt 2>/dev/null || echo "No hay archivos aún"

      - name: 💾 Save Results
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Product Bot"
          git add .
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "🤖 Productos creados: $(date '+%Y-%m-%d %H:%M')"
            git push
            echo "✅ Archivos guardados en GitHub"
          else
            echo "📝 Sin cambios para guardar"
          fi

      - name: 🎉 Success Summary
        run: |
          echo "🎉 Bot ejecutado exitosamente!"
          echo "📅 Fecha: $(date)"
          echo "🔄 Próxima ejecución: en 12 horas"
          echo "📁 Revisa el repositorio para nuevos archivos"
