# .github/workflows/simple-bot.yml
# VersiÃ³n SIMPLIFICADA - Solo crea productos locales
name: ğŸ¤– Simple Product Bot
on:
  schedule:
    - cron: '0 */12 * * *'  # Cada 12 horas
  workflow_dispatch:

jobs:
  create-products:
    name: ğŸ“Š Crear Productos
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ğŸ“¦ Install Dependencies  
        run: |
          pip install requests openai==0.28.1 reportlab

      - name: ğŸ” Verify API Key
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          if [ -z "$OPENAI_API_KEY" ]; then
            echo "âŒ OPENAI_API_KEY no configurado"
            exit 1
          fi
          echo "âœ… OpenAI API configurada"

      - name: ğŸš€ Create Products
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python simple_main.py

      - name: ğŸ“ List Created Files
        run: |
          echo "ğŸ“Š Archivos creados:"
          ls -la *.pdf *.txt 2>/dev/null || echo "No hay archivos aÃºn"

      - name: ğŸ’¾ Save Results
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Product Bot"
          git add .
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "ğŸ¤– Productos creados: $(date '+%Y-%m-%d %H:%M')"
            git push
            echo "âœ… Archivos guardados en GitHub"
          else
            echo "ğŸ“ Sin cambios para guardar"
          fi

      - name: ğŸ‰ Success Summary
        run: |
          echo "ğŸ‰ Bot ejecutado exitosamente!"
          echo "ğŸ“… Fecha: $(date)"
          echo "ğŸ”„ PrÃ³xima ejecuciÃ³n: en 12 horas"
          echo "ğŸ“ Revisa el repositorio para nuevos archivos"
